<template>
    <template if:true={task}>
        <article class="slds-card slds-card_boundary" style={dynamicBorderStyle}>
            
            <div class="slds-card__header slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name="utility:rows" size="small" class="slds-text-color_weak"></lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <h2 class="slds-card__header-title">
                            <span class="slds-text-heading_small slds-truncate" title={task.Title}>
                                {task.Title}
                            </span>
                        </h2>
                    </div>
                </header>
                
                <div class="slds-no-flex slds-grid slds-grid_vertical-align-center">
                    <lightning-badge label={task.Status} style={statusBadgeStyle}></lightning-badge>
                    <lightning-button-icon
                        icon-name="utility:delete"
                        variant="bare"
                        size="medium"
                        alternative-text="Delete"
                        onclick={handleDelete}
                        class="slds-m-left_small slds-text-color_error"
                    ></lightning-button-icon>
                </div>
            </div>

            <div class="slds-card__body">
                <template if:true={task.Description}>
                    <p class="slds-text-body_regular slds-m-bottom_medium slds-text-color_default" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                        {task.Description}
                    </p>
                </template>

                <div class="slds-grid slds-grid_vertical slds-gap_x-small">
                    
                    <div class="slds-grid slds-grid_vertical-align-center">
                        <lightning-icon icon-name="utility:event" size="x-small" class="slds-m-right_small slds-text-color_weak"></lightning-icon>
                        <template if:true={task.Due_Date_ISO}>
                            <lightning-formatted-date-time
                                class="slds-text-body_small slds-text-color_weak"
                                value={task.Due_Date_ISO}
                                year="numeric"
                                month="short"
                                day="2-digit"
                                weekday="short"> </lightning-formatted-date-time>
                        </template>
                        <template if:false={task.Due_Date_ISO}>
                            <span class="slds-text-body_small slds-text-color_weak">{task.Due_Date}</span>
                        </template>
                    </div>

                    <template if:true={task.Context}>
                        <div class="slds-grid slds-grid_vertical-align-center">
                            <lightning-icon icon-name="utility:location" size="x-small" class="slds-m-right_small slds-text-color_weak"></lightning-icon>
                            <span class="slds-text-body_small slds-text-color_weak slds-truncate" title={task.Context}>{task.Context}</span>
                        </div>
                    </template>

                    <template if:true={task.Energy_Level}>
                        <div class="slds-grid slds-grid_vertical-align-center slds-m-top_xx-small">
                            <lightning-icon icon-name="utility:lightning" size="x-small" class="slds-m-right_small slds-text-color_weak"></lightning-icon>
                            <lightning-badge label={task.Energy_Level} style={energyBadgeStyle}></lightning-badge>
                        </div>
                    </template>
                </div>
            </div>

            <div class="slds-card__footer">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-combobox
                            variant="label-hidden"
                            placeholder="Update Status..."
                            value={task.Status}
                            options={statusOptions}
                            onchange={handleStatusChange}
                            class="slds-size_1-of-1" 
                        ></lightning-combobox>
                    </div>
                </div>
            </div>
        </article>
    </template>
</template>